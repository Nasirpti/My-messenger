<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ناصر میسنجر - پرو</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #e5ddd5; display: flex; flex-direction: column; height: 100vh; }
        #chat-header { background: #075e54; color: white; padding: 15px; text-align: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .input-area { background: #f0f0f0; padding: 10px; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; border: none; padding: 12px; border-radius: 25px; outline: none; font-size: 16px; }
        button { background: #075e54; color: white; border: none; padding: 10px 20px; border-radius: 50%; cursor: pointer; font-size: 18px; }
        .msg { max-width: 85%; padding: 8px 12px; border-radius: 10px; position: relative; font-size: 15px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .sent { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 0; }
        .received { align-self: flex-start; background: white; border-bottom-left-radius: 0; }
        .sender-name { font-size: 11px; font-weight: bold; color: #075e54; display: block; margin-bottom: 2px; }
        .time { font-size: 10px; color: #666; float: right; margin-top: 5px; margin-left: 10px; }
    </style>
</head>
<body>

<div id="chat-header">ناصر چیٹ روم</div>
<div id="messages"></div>

<div class="input-area">
    <input type="text" id="user-msg" placeholder="پیغام لکھیں...">
    <button onclick="sendMsg()">➤</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmhQMRVK5HwJ9t5xIteYXD-1rQgIK0q4I",
    authDomain: "my-messenger-220f7.firebaseapp.com",
    projectId: "my-messenger-220f7",
    databaseURL: "https://my-messenger-220f7-default-rtdb.firebaseio.com/",
    storageBucket: "my-messenger-220f7.firebasestorage.app",
    messagingSenderId: "808991752554",
    appId: "1:808991752554:web:939b6b03c61f28eba32513"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  let userName = prompt("آپ کا نام؟") || "مہمان";
  
  signInAnonymously(auth).then(() => {
      console.log("لاگ ان کامیاب!");
  });

  const messagesRef = ref(db, 'messages');

  window.sendMsg = function() {
    let input = document.getElementById('user-msg');
    if (input.value.trim() !== "") {
        let now = new Date();
        let time = now.getHours() + ":" + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();

        push(messagesRef, {
            sender: userName,
            text: input.value,
            time: time,
            uid: auth.currentUser ? auth.currentUser.uid : "anon"
        });
        input.value = "";
    }
  }

  onChildAdded(messagesRef, (data) => {
      const msg = data.val();
      let msgArea = document.getElementById('messages');
      
      // میسج آنے پر آواز
      let notify = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
      notify.play().catch(e => console.log("آواز کے لیے پہلے اسکرین پر کہیں کلک کریں"));

      let isMine = msg.sender === userName;
      let msgClass = isMine ? "sent" : "received";

      msgArea.innerHTML += `
          <div class="msg ${msgClass}">
              <span class="sender-name">${msg.sender}</span>
              ${msg.text}
              <span class="time">${msg.time}</span>
          </div>
      `;
      msgArea.scrollTop = msgArea.scrollHeight;
  });
</script>

</body>
    </html>
    
